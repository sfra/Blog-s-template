let config={contextMenu:!1},$form=document.createElement("form");$form.method="post",$form.action="addPost.php";let $inputTitle=document.createElement("input");$inputTitle.name="title";let $inputContent=document.createElement("input");$inputContent.name="content";let $inputCategory=document.createElement("input");$inputCategory.name="category";let $inputShorter=document.createElement("input");$inputShorter.name="shorter";let $inputMainImage=document.createElement("input");$inputMainImage.name="mainImage",$form.appendChild($inputTitle),$form.appendChild($inputContent),$form.appendChild($inputCategory),$form.appendChild($inputShorter),$form.appendChild($inputMainImage);let $contextMenu=null;createContextMenu();function createContextMenu(){$contextMenu=document.createElement("div"),$contextMenu.setAttribute("id","contextMenu"),$contextMenu.innerHTML="Kopiuj adres"}window.onload=function(){let a=document.getElementById("uploaded-files");-1!==window.location.href.indexOf("?")&&(sessionStorage.setItem("images",sessionStorage.getItem("images")+"@"+window.location.href.split("?")[1].split("=")[1]),window.location.href="edit.php"),tinyMCE.activeEditor.getContent({format:"raw"}),null!==sessionStorage.getItem("content")&&tinyMCE.activeEditor.setContent(sessionStorage.getItem("content"));let b=document.getElementById("send-image");if(b.addEventListener("submit",function(){tinyMCE.activeEditor.getContent({format:"raw"}),sessionStorage.setItem("content",tinyMCE.activeEditor.getContent({format:"raw"}))},!1),null!==sessionStorage.getItem("images")){let b=sessionStorage.getItem("images").split("@"),c=null,d=null,e=null;for(let f=1,g=b.length;f<g;f++)parentOfCurrent=document.createElement("div"),d=document.createElement("img"),d.src="../images/cross_b.svg",d.classList.add("close"),parentOfCurrent.appendChild(d),c=document.createElement("img"),c.src="uploads/"+b[f],parentOfCurrent.appendChild(c),e=document.createElement("div"),e.classList.add("title"),e.innerHTML=b[f],parentOfCurrent.appendChild(e),a.appendChild(parentOfCurrent),d.addEventListener("click",function(){console.log(this),document.getElementById("uploaded-files").removeChild(this.parentElement),function(a){sessionStorage.setItem("images",sessionStorage.getItem("images").replace(a+"@","").replace(a,""))}(b[f]),"@"===sessionStorage.getItem("images")[sessionStorage.getItem("images").length-1]&&sessionStorage.setItem("images",sessionStorage.getItem("images").substring(0,sessionStorage.getItem("images").length-1)),function(a){window.location.href="removeFile.php?file="+a}(b[f])},!1)}document.getElementById("save").addEventListener("click",function(){document.body.appendChild($form),$inputTitle.value=document.getElementById("title").value,rawContent=tinyMCE.activeEditor.getContent({format:"raw"});let a=null,b=[];rawContent=rawContent.replace(/(<img src="([^"]*)"([^>]+)>)/ig,(c,d,e,f)=>{debugger;return console.log(arguments),a=`${functions.genetareRandomId(70)}_${e}`,b.push({old:e,new:a}),`<img class="sizedependent" srcc="[@images/usersImages/${a}@]"${f} />`});let c,d=document.getElementById("mainImage").value,e=d;c=functions.genetareRandomId(70)+"_"+e;let f=new __ajax("mvImages.php",{value:"POST"});f.setParameters({images:JSON.stringify(b),mainImage:JSON.stringify({old:e,new:c})}),f.get().then(function(){let a=new __ajax("addPost.php",{value:"POST"});a.setParameters({title:$inputTitle.value,content:rawContent,category:document.getElementById("category").value,shorter:document.getElementById("shorter").value,mainImage:"images/usersImages/"+c}),a.get().then(a=>{console.log(a)}),$inputContent.value=rawContent,$inputCategory.value=document.getElementById("category").value,$inputShorter.value=document.getElementById("shorter").value,$inputMainImage.value=c})},!1),document.getElementById("wrapper-0").addEventListener("click",function(a){let b=a.target;config.contextMenu&&(null==b.getAttribute("id")||"imgWrapper"!==b.getAttribute("id"))&&($contextMenu.parentElement.removeChild($contextMenu),config.contextMenu=!1,createContextMenu())},!1),document.getElementById("wrapper-0").addEventListener("contextmenu",function(a){let b=a.target;if(console.log(a),config.contextMenu&&($contextMenu.parentElement.removeChild($contextMenu),config.contextMenu=!1,createContextMenu()),"IMG"!==b.nodeName)return $contextMenu=document.getElementById("contextMenu"),null!==$contextMenu&&($contextMenu.parentElement.removeChild($contextMenu),config.contextMenu=!1,createContextMenu()),(createContextMenu(),void a.preventDefault());if(!config.contextMenu){window.getComputedStyle(b);$contextMenu.style.position="fixed",$contextMenu.style.zIndex="400",$contextMenu.style.top=a.pageY-40+"px",b.parentElement.appendChild($contextMenu),config.contextMenu=!0,setTimeout(function(){$contextMenu.classList.add("visible")},100),$contextMenu.addEventListener("click",function(){copyToClipboard(b.parentElement.querySelector(".title").innerText),$contextMenu.classList.add("clicked");let a=$contextMenu.parentElement;setTimeout(function(){config.contextMenu&&(a.removeChild($contextMenu),config.contextMenu=!1,createContextMenu())},100)},!1)}a.preventDefault()},!1)};