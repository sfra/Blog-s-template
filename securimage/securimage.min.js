var SecurimageAudio=function(a){this.html5Support=!0,this.flashFallback=!1,this.captchaId=null,this.playing=!1,this.reload=!1,this.audioElement=null,this.controlsElement=null,this.playButton=null,this.playButtonImage=null,this.loadingImage=null,a.audioElement&&(this.audioElement=document.getElementById(a.audioElement)),a.controlsElement&&(this.controlsElement=document.getElementById(a.controlsElement)),this.init()};SecurimageAudio.prototype.init=function(){var a=navigator.userAgent.toLowerCase(),b=-1!=a.indexOf("msie")&&parseInt(a.split("msie")[1]);b||null==(b=a.match(/trident\/.*rv:(\d+\.\d+)/))||(b=parseInt(b[1]));var c=this.audioElement.getElementsByTagName("object");if(c=0<c.length?c[0]:null,b){if(9>b)return this.controlsElement.style.display="none",void(this.html5Support=!1);if(""==this.audioElement.canPlayType("audio/wav")){var d,e=this.audioElement.getElementsByTagName("source"),f=!1;c&&(this.flashFallback=!0);for(var g=0;g<e.length;++g)if(d=e[g].attributes.type.value,0<=d.toLowerCase().indexOf("mpeg")||0<=d.toLowerCase().indexOf("mp3")){f=!0;break}if(!1==f){if(this.html5Support=!1,this.flashFallback){var h=document.createElement("object"),j=document.createElement("param"),k=c.getElementsByTagName("param");this.copyElementAttributes(h,c),0<k.length&&(this.copyElementAttributes(j,k[0]),h.appendChild(j)),c.parentNode.removeChild(c),this.audioElement.parentNode.appendChild(h)}return this.audioElement.parentNode.removeChild(this.audioElement),void this.controlsElement.parentNode.removeChild(this.controlsElement)}}}this.audioElement.addEventListener("playing",this.updateControls.bind(this),!1),this.audioElement.addEventListener("ended",this.audioStopped.bind(this),!1);for(var l,m=this.controlsElement.getElementsByTagName("*"),g=0;g<m.length;++g)l=m[g],null!=l.className&&(0<=l.className.indexOf("play_button")?(this.playButton=l,l.addEventListener("click",this.play.bind(this),!1)):0<=l.className.indexOf("play_image")?this.playButtonImage=l:0<=l.className.indexOf("loading_image")&&(this.loadingImage=l));c&&c.parentNode.removeChild(c)},SecurimageAudio.prototype.play=function(a){null!=this.playButton&&this.playButton.blur(),this.reload&&(this.replaceElements(),this.reload=!1);try{if(!this.playing){null!=this.playButtonImage&&(this.playButtonImage.style.display="none"),null!=this.loadingImage&&(this.loadingImage.style.display=""),this.audioElement.onerror=this.audioError;try{this.audioElement.play()}catch(a){alert("Audio error: "+a)}}else this.audioElement.pause(),null!=this.loadingImage&&(this.loadingImage.style.display="none"),null!=this.playButtonImage&&(this.playButtonImage.style.display=""),this.playing=!1}catch(a){alert("Audio error: "+a)}return void 0!==a&&a.preventDefault(),!1},SecurimageAudio.prototype.refresh=function(a){if(this.html5Support)return void 0!==a&&(this.captchaId=a),this.playing=!0,this.reload=!1,this.play(),this.reload=!0,!1},SecurimageAudio.prototype.copyElementAttributes=function(a,b){for(var c=0,d=b.attributes,e=d.length;c<e;++c)a.setAttribute(d[c].nodeName,d[c].value);return a},SecurimageAudio.prototype.replaceElements=function(){var a=this.audioElement.parentNode;a.removeChild(this.audioElement);var b=document.createElement("audio");b.setAttribute("style","display: none;"),b.setAttribute("preload","false"),b.setAttribute("id",this.audioElement.id);for(var d=0;d<this.audioElement.children.length;++d)if("source"==this.audioElement.children[d].tagName.toLowerCase()){var e=document.createElement("source");this.copyElementAttributes(e,this.audioElement.children[d]);var f=null===this.captchaId?(Math.random()+"").replace("0.",""):this.captchaId;e.src=e.src.replace(/([?|&])id=[a-zA-Z0-9]+/,"$1id="+f),b.appendChild(e)}this.audioElement=null,this.audioElement=b,a.appendChild(this.audioElement),this.audioElement.addEventListener("playing",this.updateControls.bind(this),!1),this.audioElement.addEventListener("ended",this.audioStopped.bind(this),!1)},SecurimageAudio.prototype.updateControls=function(){this.playing=!0,null!=this.loadingImage&&(this.loadingImage.style.display="none"),null!=this.playButtonImage&&(this.playButtonImage.style.display="")},SecurimageAudio.prototype.audioStopped=function(){this.playing=!1},SecurimageAudio.prototype.audioError=function(a){var b=null;switch(a.target.error.code){case a.target.error.MEDIA_ERR_ABORTED:break;case a.target.error.MEDIA_ERR_NETWORK:b="A network error caused the audio download to fail.";break;case a.target.error.MEDIA_ERR_DECODE:alert("An error occurred while decoding the audio");break;case a.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:alert("The audio format is not supported by your browser.");break;default:alert("An unknown error occurred trying to play the audio.");}b&&alert("Audio playback error: "+b)};